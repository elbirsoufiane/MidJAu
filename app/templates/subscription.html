{% extends "base.html" %}

{% block title %}Subscription | MidjyAuto{% endblock %}

{% block extra_style %}
<style>
/* â”€â”€â”€â”€â”€â”€â”€â”€â”€ Subscription card â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.sub-card{
    max-width:600px;
    margin:40px auto;
    border:2px solid #007bff;            /* same colour / thickness as buttons */
    border-radius:14px;
    background:#ffffff;
    box-shadow:0 0 0 3px rgba(0,123,255,.12); /* subtle halo */
    overflow:hidden;
}

/* header row */
.sub-hdr{
    background:#007bff;
    color:#fff;
    padding:18px 26px;
    font-size:20px;
    font-weight:600;
    letter-spacing:.3px;
}

/* data rows */
.sub-row{
    display:flex;             /* â† no space-between, so items hug left */
    align-items:center;
    gap:32px;                 /* space between label and value         */
    padding:18px 26px;
    font-size:16px;
}
.sub-row:nth-child(odd){background:#f8fafe;}  /* zebra stripe */

/* cells */
.sub-label{
    font-weight:600;
    color:#333;
    min-width:200px;          /* keeps all values neatly aligned       */
}
.sub-val{
    color:#111;
    text-align:left;          /* explicit, though default in flex row  */
}
</style>
{% endblock %}

{% block content %}
  <h2 class="title">ğŸ’³ My Subscription</h2>

  <div class="sub-card">
     <div class="sub-hdr">Subscription Details</div>

     <div class="sub-row">
        <span class="sub-label">Tier</span>
        <span class="sub-val" id="tier-val">{{ details.tier }}</span>
     </div>

     <div class="sub-row">
        <span class="sub-label">Expiry Date</span>
        <span class="sub-val" id="expiry-val">{{ details.expiry }}</span>
     </div>

     <div class="sub-row">
        <span class="sub-label">Daily Quota</span>
        <span class="sub-val" id="daily-quota-val">{{ details.daily_quota }}</span>
     </div>

     <div class="sub-row">
        <span class="sub-label">Job Quota</span>
        <span class="sub-val" id="job-quota-val">{{ details.job_quota }}</span>
     </div>

     <div class="sub-row">
        <span class="sub-label">Prompts Processed Today</span>
        <span class="sub-val" id="prompts-today-val">{{ details.prompts_today }}</span>
     </div>
  </div>

  <script>
    function fetchLicenseStatus() {
      fetch('/license_status')
        .then(r => r.json())
        .then(data => {
          if (data.status === 'pending') {
            setTimeout(fetchLicenseStatus, 2000);
            return;
          }

          const tierMap = { 'Tier1': 'Basic', 'Tier2': 'Pro', 'Tier3': 'Premium' };
          document.getElementById('tier-val').textContent = tierMap[data.tier] || data.tier || 'â€”';

          if (data.expiry) {
            const dateOnly = data.expiry.slice(0, 10);
            document.getElementById('expiry-val').textContent = `${dateOnly} at 12:00AM CST`;
          }

          document.getElementById('daily-quota-val').textContent = data.dailyQuota ?? 'â€”';
          document.getElementById('job-quota-val').textContent = data.jobQuota ?? 'â€”';
          document.getElementById('prompts-today-val').textContent = data.promptsToday ?? 'â€”';
        })
        .catch(() => setTimeout(fetchLicenseStatus, 2000));
    }

    fetchLicenseStatus();
  </script>
{% endblock %}
